<ion-header class="ion-no-border">
  <ion-toolbar class="nequi-toolbar">
    <ion-title class="nequi-title">Mis tareas</ion-title>
  </ion-toolbar>

  <!-- Barra de búsqueda -->
  <ion-toolbar class="nequi-toolbar">
    <ion-searchbar class="nequi-search" placeholder="Buscar tarea…" [value]="query" (ionInput)="onSearch($event)"
      debounce="150">
    </ion-searchbar>
  </ion-toolbar>

  <!-- Filtro categoría: chips (Nequi style) -->
  <ion-toolbar *ngIf="flags.enableCategories" class="nequi-toolbar">
    <div class="chip-scroll">
      <div class="chip-row">
        <ion-chip class="nequi-chip" [outline]="selectedCategoryId !== ''"
          [color]="selectedCategoryId === '' ? 'primary' : undefined" (click)="onCategoryChange('')">
          <ion-label>Todas</ion-label>
        </ion-chip>

        <ion-chip class="nequi-chip" *ngFor="let c of categories" [outline]="selectedCategoryId !== c.id"
          [color]="selectedCategoryId === c.id ? 'primary' : undefined" (click)="onCategoryChange(c.id)">
          <ion-label>{{ c.name }}</ion-label>
        </ion-chip>
      </div>
    </div>
  </ion-toolbar>

  <!-- Resumen -->
  <ion-toolbar class="nequi-toolbar">
    <div class="summary-row">
      <div class="pill">Total: <b>{{ totalCount }}</b></div>
      <div class="pill">Pendientes: <b>{{ pendingCount }}</b></div>
      <div class="pill">Hechas: <b>{{ doneCount }}</b></div>
    </div>
  </ion-toolbar>
</ion-header>

<!-- Contenido principal -->
<ion-content class="nequi-bg">
  <ion-list *ngIf="filteredTasks.length > 0; else emptyState" class="nequi-list">
    <ion-item-sliding *ngFor="let t of filteredTasks; trackBy: trackByTaskId">
      <ion-item class="nequi-item" lines="full">
        <ion-checkbox slot="start" [checked]="t.done" (ionChange)="toggleDone(t)">
        </ion-checkbox>

        <ion-label>
          <h2 class="task-title" [class.done]="t.done">{{ t.title }}</h2>
          <p class="task-sub">{{ categoryName(t.categoryId) }}</p>
        </ion-label>

        <ion-badge *ngIf="t.done" color="success" class="status-badge">Hecha</ion-badge>
        <ion-badge *ngIf="!t.done" color="warning" class="status-badge">Pendiente</ion-badge>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteTask(t)">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <!-- Estado vacío -->
  <ng-template #emptyState>
    <div class="empty">
      <div class="empty-title">No hay tareas</div>
      <div class="empty-sub">Crea tu primera tarea con el botón +</div>
    </div>
  </ng-template>

  <!-- FAB Nequi -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button class="nequi-fab" (click)="openNewTaskModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>